var background=(function(){"use strict";function a(r){return r==null||typeof r=="function"?{main:r}:r}const i=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,l=a(()=>{console.log("TabHub background service started",{id:i.runtime.id}),chrome.tabs.onRemoved.addListener(async(r,t)=>{try{const o=await chrome.storage.session.get(`tab_${r}`);if(o[`tab_${r}`]){const e=o[`tab_${r}`];if(e.url&&!e.url.startsWith("chrome://")&&!e.url.startsWith("chrome-extension://")){const n=(await chrome.storage.local.get("tabhub_closed_tabs")).tabhub_closed_tabs||[];n.unshift({id:`closed_${Date.now()}`,url:e.url,title:e.title||"无标题",favIconUrl:e.favIconUrl,closedAt:Date.now(),windowId:t.windowId}),n.length>50&&n.splice(50),await chrome.storage.local.set({tabhub_closed_tabs:n})}await chrome.storage.session.remove(`tab_${r}`)}}catch(o){console.error("Error recording closed tab:",o)}}),chrome.tabs.onUpdated.addListener(async(r,t,o)=>{if(t.status==="complete"&&o.url)try{await chrome.storage.session.set({[`tab_${r}`]:{url:o.url,title:o.title,favIconUrl:o.favIconUrl}})}catch(e){console.error("Error storing tab info:",e)}}),chrome.tabs.onCreated.addListener(async r=>{if(r.id&&r.url)try{await chrome.storage.session.set({[`tab_${r.id}`]:{url:r.url,title:r.title,favIconUrl:r.favIconUrl}})}catch(t){console.error("Error storing tab info:",t)}}),chrome.commands.onCommand.addListener(r=>{r==="open-search"&&chrome.runtime.sendMessage({action:"open-search"})})});function h(){}function s(r,...t){}const u={debug:(...r)=>s(console.debug,...r),log:(...r)=>s(console.log,...r),warn:(...r)=>s(console.warn,...r),error:(...r)=>s(console.error,...r)};let c;try{c=l.main(),c instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw u.error("The background crashed on startup!"),r}return c})();
